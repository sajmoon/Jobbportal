.row
  .span8#job_form
    -unless @job.nil?  
      = haml :"errors", locals: { errors: @job.errors }  
    .control-group{ class: ( "error" if @job.errors.has_key?(:title) ) }
      %label.control-label{for: "job_title"} Titel
      .controls
        %input.input-xlarge{type: "text", id: "job_title", name: "job[title]", value: @job.title}
        %p.help-block
          Titeln på annonsen
          - if @job.errors.has_key?(:title)
            %br
            %span
              %small
                = @job.errors[:title][0]

    .control-group{ class: ( "error" if @job.errors.has_key?(:short_description) ) }
      %label.control-label{for: "job_short_description"} Kort beskrivning
      .controls
        %input.input-xlarge{type: "text", id: "job_short_description", name: "job[short_description]", value: @job.short_description}
        %p.help-block
          En kort beskrivning
          - if @job.errors.has_key?(:short_description)
            %br
            %span
              %small
                = @job.errors[:short_description][0]

    .control-group{ class: ( "error" if @job.errors.has_key?(:description) ) }
      %label.control-label{for: "job_description"} Lång Beskrivning
      .controls
        %textarea.input-xlarge{style: "width: 600px", type: "textarea", id: "job_description", name: "job[description]", rows: 10}
          = @job.description
        %p.help-block
          Längre och mycket detaljerad beskrivning av tjänsten. Använd markups, se 
          %a{href: "http://redcloth.org/textile"} Länk till referens

          - if @job.errors.has_key?(:description)
            %br
            %span
              %small
                = @job.errors[:description][0]
          %button#job_description_show_preview
            Visa förhandsgranskning

    .control-group{ class: ( "error" if @job.errors.has_key?(:categories) ) }
      %label.control-label{for: "job_category"} Kategorier
      .controls
        - @categories.each do |category|
          %label.checkbox
            %input{type: "checkbox", name: "categories[id][]", value: category.id, checked: @job.categories.include?(category)}
            = category.name
        %p.help-block 
          Vilka kategorier bör annonsen vara associerad med
          - if @job.errors.has_key?(:categories)
            %br
            %span
              %small
                = @job.errors[:categories][0]

    .control-group{ class: ( "error" if @job.errors.has_key?(:company) ) }
      %label.control-label{for: "job_company_id"} Företag
      .controls
        %p
          = @job.company.name rescue "no company"
        %input.input-xlarge{type: "hidden", id: "job_company_id", name: "job[company_id]", value: @job.company_id}
        %p.help-block
          Det företag som annonsen tillhör
          - if @job.errors.has_key?(:company)
            %br
            %span
              %small
                = @job.errors[:company][0]

    .control-group{ class: ( "error" if @job.errors.has_key?(:apply_url) ) }
      %label.control-label{for: "job_apply_url"}Webbadress till externt anmälningsformulär
      .controls
        %input.input-xlarge{type: "text", id: "job_apply_url", name: "job[apply_url]", value: @job.apply_url}
        %p.help-block
          Lämnas fältet tomt, så visas den registrerade mailadressen.
          - if @job.errors.has_key?(:apply_url)
            %br
            %span
              %small
                = @job.errors[:apply_url][0]

    - if !@job.has_started?
      .control-group{ class: ( "error" if @job.errors.has_key?(:starttime) ) }
        %label.control-label{for: "job_starttime"} Tid då annonsen ska börja visas.
        .controls
          %input.input-xlarge{type: "text", class: "timeselector", id: "job_starttime", name: "job[starttime]", value: @job.starttime}
          %p.help-block
            Klicka i textfältet för en kalender.
            - if @job.errors.has_key?(:starttime)
              %br
              %span
                %small
                  = @job.errors[:startime][0]
    - else
      %h5
        = "Annonsen visas mellan #{@job.starttime} och #{@job.endtime} ( Den visas under #{@job.weeks} veckor)"
    
    .control-group{ class: ( "error" if @job.errors.has_key?(:weeks) ) }
      %label.control-label{for: "job_endtime"} Hur många veckor ska annonsen visas.
      .controls
        %select{id: "job_number_of_weeks", name: "job[weeks]"}
          - ((@job.weeks_passed)..(@job.weeks_passed + 5)).each do |w|
            - unless w == 0
              %option{value: w, selected: ( "selected" if @job.weeks == w)} 
                = "#{w} vecka"
        %p.help-block
          - if @job.errors.has_key?(:weeks)
            %br
            %span
              %small
                = @job.errors[:endtime][0]

  .span4
    .preview
      %h5
        En förhandsvisning av hur den stora beskrivningen kommer att se ut.
      #loading-preview.hide
        Loading..
      #descPreview

